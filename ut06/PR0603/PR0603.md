# PR0603: Campos calculados y restricciones

### Crear el módulo `stock.py`

```python
from odoo import models, fields, api
from odoo.exceptions import ValidationError


class Stock(models.Model):
    _name = 'stock_management.stock'
    _description = 'Modelo para el stock de los productos.'
    # RESTRICCIONES SQL
    _sql_constraints = [
        ('name_unique', 'UNIQUE(name)', 'El nombre del producto ya existe y debe ser único.'),
        ('quantity_check', 'CHECK(quantity >= 0)', 'La cantidad en stock no puede ser negativa.'),
    ]

    name = fields.Char()
    category = fields.Selection([
        ('tecnologia', 'Tecnología'),
        ('muebles', 'Muebles'),
        ('ropa', 'Ropa')
    ], required=True)
    price = fields.Float()
    quantity = fields.Integer()
    total_value = fields.Float(compute = "calcularstock") # Compute llama a la función pasada por parámetro para calcular el valor

    @api.depends('price', 'quantity')
    def calcularstock(self):
        for stock in self:
            stock.total_value = stock.price * stock.quantity

    minimun_quantity = fields.Integer()
    stock_status = fields.Selection([
        ('normal', 'Normal'),
        ('lowstock', 'Low Stock')
    ], compute="estadostock")

    @api.depends('quantity', 'minimun_quantity')
    def estadostock(self):
        for stock in self:
            if stock.quantity>stock.minimun_quantity:
                stock.stock_status = 'normal'
            else :
                stock.stock_status = 'lowstock'

# SEGUIR
    fullname = fields.Char(compute = "calcularnombrecompleto")
    @api.depends('name','category')
    def calcularnombrecompleto(self):
        for stock in self:
            stock.fullname = f"{stock.name} ({stock.category})"
    
    # RESTRICCIONES PYTHON
    # Cada vez que se price o quantity cambia, se llama a esta función
    @api.constrains('price', 'quantity')
    def restriccionespy(self):
        for stock in self:
            if stock.price <= 0:
                raise ValidationError("El precio debe ser mayor que 0.")

        
            if stock.quantity < 0:
                raise ValidationError("La cantidad debe ser mayor o igual a 0.")

            
            total_value = stock.price * stock.quantity
            if stock.total_value > 100000:
                raise ValidationError(f"El valor total del stock ({total_value}) supera el límite permitido de 100,000.")
```