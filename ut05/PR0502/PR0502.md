# PR0502: Módulo con dos modelos

### En esta ocasión vamos a crear un módulo de gestión de biblioteca que contendrá dos modelos, uno para almacenar los autores y otro para los libros. Esto implica que nuestro módulo tendrá dos modelos, y, de forma análoga tendrá una vista para cada modelo.

Los campos que tendrá cada modelo son:

- Autor
    - Nombre
    - Fecha de nacimiento
    - Biografía
    - Libros, este campo debería ser una relación de uno a muchos en nuestra base de datos, como aún no hemos visto como hacerlo nos limitaremos a dejarlo de tipo texto.
- Libro
    - Nombre
    - Autor, nuevamente, este campo debería estar relacionado con el tro modelo. Por ahora lo dejaremos de tipo char
    - Fecha de publicación
    - ISBN
    - Sinopsis

<br>
1. Empezamos a crear cada módulo para los libros y los autores.<br>

*Módulo de autores*
```python

from odoo import models, fields, api

class gestion_autores(models.Model):
    _name = 'gestion_biblioteca.autor'
    _description = 'Modelo de gestión de autores'
    nombre = fields.Char()
    fechanac = fields.Date()
    biografia = fields.Text()
    libros = fields.Char()
```

*Módulo de libros*
```python

from odoo import models, fields, api

class gestion_libros(models.Model):
    _name = 'gestion_biblioteca.libros'
    _description = 'Modelo de gestión de libros'
    nombre = fields.Char()
    autor = fields.Char()
    fechapubli = fields.Date()
    ISBN = fields.Char()
    sinopsis = fields.Text()
```

2. En el archivo `__init__.py` dentro de la carpeta models, metemos lo siguiente para que Odoo utilice esos modelos.

```python
from . import library_autor
from . import library_book
```

3. Ahora, vamos a crear la views.
Dentro de la carpeta views, creamos los siguientes archivos

- library_author_views.xml

```xml
<odoo>
    <data>
        <record model="ir.ui.view" id="gestion_biblioteca.listaautores">
        <field name="name">Lista de autores</field>
        <field name="model">gestion_biblioteca.autor</field>
        <field name="arch" type="xml">
            <tree>
                <field name="nombre"/>
                <field name="fechanac"/>
                <field name="biografia"/>
                <field name="libros"/>
            </tree>
        </field>
        </record>
    </data>
</odoo>
```

- library_book_views.xml

```xml
<odoo>
    <data>
        <record model="ir.ui.view" id="gestion_biblioteca.listalibros">
        <field name="name">Lista de libros</field>
        <field name="model">gestion_biblioteca.libros</field>
        <field name="arch" type="xml">
            <tree>
                <field name="nombre"/>
                <field name="autor"/>
                <field name="fechapubli"/>
                <field name="ISBN"/>
                <field name="sinopsis"/>
            </tree>
        </field>
        </record>
    </data>
</odoo>
```

- library_menu_views.xml

```xml
<odoo>
    <data>
        <!-- Acciones de los menus -->
        <record model="ir.actions.act_window" id="action_listalibros">
            <field name="name">Libros</field>
            <field name="res_model">gestion_biblioteca.libros</field>
            <field name="view_mode">tree,form</field>
        </record>

        <record model="ir.actions.act_window" id="action_listaautores">
            <field name="name">Autores</field>
            <field name="res_model">gestion_biblioteca.autor</field>
            <field name="view_mode">tree,form</field>
        </record>
        <!-- Top menu item -->
        <menuitem name="Gestión de biblioteca" id="gestion_biblioteca.menu_root"/>
        <!-- menu categories -->
        <menuitem name="Libros" id="gestion_biblioteca.menu_1" parent="gestion_biblioteca.menu_root"/>
        <menuitem name="Lista de Libros" id="gestion_biblioteca.menu_libros_list" parent="gestion_biblioteca.menu_1" action="action_listalibros"/>
        <menuitem name="Autores" id="gestion_biblioteca.menu_2" parent="gestion_biblioteca.menu_root"/>
        <menuitem name="Lista de Autores" id="gestion_biblioteca.menu_autores_list" parent="gestion_biblioteca.menu_2" action="action_listaautores"/>
    </data>
</odoo>
```

4. Después, hacemos que Odoo cargue las views en el manifest. Añadiendo estas líneas en el apartado *data*

```python
    'data': [
        'security/ir.model.access.csv',
        'views/views.xml',
        'views/library_menu_views.xml',
        'views/library_book_views.xml',
        'views/library_author_views.xml',
        #'views/templates.xml',
    ],
```

5. Configuramos la seguridad de la aplicación. Esto se encuentra en el archivo `ir.model.access.csv`.<br>
Aquí quitaremos el modelo configurado por defecto y añadiremos los nuestros

```
access_gestion_biblioteca_autor,gestion_biblioteca.autor,model_gestion_biblioteca_autor,base.group_user,1,1,1,1
access_gestion_biblioteca_book,gestion_biblioteca.book,model_gestion_biblioteca_libros,base.group_user,1,1,1,1
```

6. Así, ya debería de aparecernos nuestra aplicación en Odoo
![Imagen1](./img/Captura%20de%20pantalla%202025-12-02%20123942.png)<br>
